#!/bin/bash
# Debug-aware LED control for NetworkManager dispatcher

INTERFACE=$1
STATUS=$2

# Define LED paths (fixed mapping: wwan0 → green:wan, wlan0 → blue:wlan)
WAN_LED="/sys/class/leds/green:wlan/brightness"
WLAN_LED="/sys/class/leds/blue:wan/brightness"

LOGFILE="/var/log/nm-leds.log"

echo "[$(date)] Interface=$INTERFACE Status=$STATUS" >> "$LOGFILE"

case "$INTERFACE" in
    wwan0|wwan0qmi0)
        if [ "$STATUS" = "up" ]; then
            echo "Turning ON WAN LED ($WAN_LED)" >> "$LOGFILE"
            echo 1 > "$WAN_LED"
        else
            echo "Turning OFF WAN LED ($WAN_LED)" >> "$LOGFILE"
            echo 0 > "$WAN_LED"
        fi
        ;;
    wlan0)
        if [ "$STATUS" = "up" ]; then
            echo "Turning ON WLAN LED ($WLAN_LED)" >> "$LOGFILE"
            echo 1 > "$WLAN_LED"
        else
            echo "Turning OFF WLAN LED ($WLAN_LED)" >> "$LOGFILE"
            echo 0 > "$WLAN_LED"
        fi
        ;;
    *)
        echo "Unknown interface: $INTERFACE (ignored)" >> "$LOGFILE"
        ;;
esac

